using Loot.UI.Common;
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Graphics;
using Terraria.GameContent.UI.Elements;
using Terraria.UI;

namespace Loot.UI
{
	internal class GuiTabToggle : UIElement
	{
		public readonly GuiTabState TargetState;

		public delegate void WhenClickedEvent(UIMouseEvent evt, UIElement listeningElement, GuiTabToggle toggle);
		public event WhenClickedEvent WhenClicked;

		private UIImageButton _button;
		private Texture2D _texture;

		public new float VisibilityActive { get; private set; } = 1f;
		public new float VisibilityInactive { get; private set; } = 0.4f;
		public float VisiblityMultiplier => IsActive ? VisibilityActive : VisibilityInactive;
		public bool IsActive { get; private set; }

		public GuiTabToggle(GuiTabState state)
		{
			TargetState = state;
			_texture = GetTexture();
			OnLeftClick += (evt, element) =>
			{
				WhenClicked?.Invoke(evt, element, this);
			};
		}

		public override void OnInitialize()
		{
			Height.Set(_texture.Height, 0);
			Width.Set(_texture.Width, 0);
			_button = new UIImageButton(_texture);
			Append(_button);
		}

		protected override void DrawSelf(SpriteBatch spriteBatch)
		{
			CalculatedStyle dimensions = GetDimensions();
			spriteBatch.Draw(_texture, dimensions.Position(), Color.White * VisiblityMultiplier);
		}

		private Texture2D GetTexture()
		{
			switch (TargetState)
			{
				default:
				case GuiTabState.CUBING:
					return Assets.Textures.GUI.Tabs.CubingTabTexture;
				case GuiTabState.ESSENCE:
					return Assets.Textures.GUI.Tabs.EssenceCraftTexture;
				case GuiTabState.SOULFORGE:
					return Assets.Textures.GUI.Tabs.SoulforgeTexture;
			}
		}

		public void SetVisibility(float whenActive, float whenInactive)
		{
			VisibilityActive = MathHelper.Clamp(whenActive, 0f, 1f);
			VisibilityInactive = MathHelper.Clamp(whenInactive, 0f, 1f);
			_button.SetVisibility(whenActive, whenInactive);
		}

		public void SetActive(bool state)
		{
			IsActive = state;
		}
	}
}
